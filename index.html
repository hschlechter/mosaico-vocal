<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Monogramas para una voz ‚Äì Hans Schlechter</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Obra medial interactiva de Hans Schlechter. Un sistema de monogramas 2√ó3 que responde en tiempo real a la voz de quien interact√∫a." />

  <style>
    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #000;
      color: #f5f5f5;
      overflow: hidden;
    }

    body {
      display: grid;
      grid-template-columns: minmax(280px, 380px) 1fr;
      grid-template-rows: 100%;
    }

    /* Panel lateral (texto + controles) */
    .side-panel {
      position: relative;
      padding: 1.5rem 1.25rem 1.25rem;
      background: radial-gradient(circle at top left, #333 0, #111 46%, #000 100%);
      border-right: 1px solid rgba(255,255,255,0.06);
      display: flex;
      flex-direction: column;
      gap: 1rem;
      z-index: 10;
    }

    .title-block h1 {
      margin: 0;
      font-size: 1.3rem;
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }

    .title-block h2 {
      margin: 0.25rem 0 0;
      font-size: 0.9rem;
      font-weight: 400;
      opacity: 0.8;
    }

    .meta {
      font-size: 0.8rem;
      opacity: 0.8;
    }

    .statement {
      font-size: 0.82rem;
      line-height: 1.5;
      opacity: 0.9;
    }

    .instructions {
      font-size: 0.8rem;
      line-height: 1.4;
      border-top: 1px solid rgba(255,255,255,0.1);
      padding-top: 0.75rem;
      margin-top: 0.25rem;
    }

    .controls {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      flex-wrap: wrap;
      margin-top: 0.25rem;
    }

    button {
      padding: 0.45rem 0.9rem;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 0.82rem;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      white-space: nowrap;
    }

    #startBtn {
      background: #22c55e;
      color: #000;
      font-weight: 600;
    }
    #stopBtn {
      background: #ef4444;
      color: #fff;
      font-weight: 600;
    }

    #status {
      font-size: 0.78rem;
      opacity: 0.85;
    }

    #transcriptLabel {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      opacity: 0.65;
      margin-top: 0.5rem;
    }

    #transcript {
      font-size: 0.78rem;
      max-height: 5.8rem;
      overflow: auto;
      padding: 0.35rem 0.5rem;
      background: rgba(0,0,0,0.35);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 0.4rem;
    }

    .footnote {
      margin-top: auto;
      font-size: 0.7rem;
      opacity: 0.7;
      border-top: 1px solid rgba(255,255,255,0.12);
      padding-top: 0.6rem;
    }

    .footnote a {
      color: #a5b4fc;
      text-decoration: none;
    }
    .footnote a:hover {
      text-decoration: underline;
    }

    /* Zona de la obra (canvas) */
    .canvas-wrapper {
      position: relative;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at center, #111 0, #000 52%, #000 100%);
    }

    #stageCanvas {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      display: block;
    }

    #wordLabel {
      position: absolute;
      bottom: 1.2rem;
      right: 1.4rem;
      font-size: 1.2rem;
      opacity: 0.4;
      pointer-events: none;
    }

    @media (max-width: 800px) {
      body {
        grid-template-columns: 1fr;
        grid-template-rows: auto 1fr;
      }
      .side-panel {
        min-height: 260px;
        border-right: none;
        border-bottom: 1px solid rgba(255,255,255,0.08);
      }
    }
  </style>
</head>
<body>
  <aside class="side-panel">
    <div class="title-block">
      <h1>Monogramas para una voz</h1>
      <h2>Obra medial interactiva ¬∑ Hans Schlechter</h2>
    </div>

    <div class="meta">
      <div>A√±o: 2025</div>
      <div>Medio: sistema generativo en tiempo real, monogramas 2√ó3, voz y proyecci√≥n.</div>
    </div>

    <div class="statement">
      <p>
        Esta obra traduce la voz en un alfabeto aglutinante de monogramas construidos desde una matriz 2√ó3.
        Cada palabra pronunciada se transforma en un mosaico continuo donde las celdas se encienden y apagan,
        componiendo una escritura paralela a lo que se dice.
      </p>
      <p>
        No hay un texto fijo ni un poema predeterminado: quien interact√∫a es libre de hablar, jugar, repetir,
        susurrar o gritar. La m√°quina escucha y responde con una graf√≠a modular, siempre imperfecta e inexacta,
        que registra la presencia de la voz m√°s que su significado.
      </p>
    </div>

    <div class="instructions">
      <strong>Instrucciones de interacci√≥n:</strong>
      <ul style="padding-left: 1.1rem; margin: 0.4rem 0 0;">
        <li>Usa preferentemente <b>Chrome de escritorio</b>.</li>
        <li>Pulsa <b>‚ÄúStart‚Äù</b> y autoriza el uso del micr√≥fono.</li>
        <li>Habla libremente: palabras, sonidos, poemas, juegos de voz.</li>
        <li>Cada palabra genera un mosaico de monogramas aglutinados.</li>
        <li>Para detener la escucha, pulsa <b>‚ÄúStop‚Äù</b>.</li>
      </ul>

      <div class="controls">
        <button id="startBtn">üéôÔ∏è Start</button>
        <button id="stopBtn" disabled>‚èπ Stop</button>
      </div>

      <div id="status">Listo. Pulsa ‚ÄúStart‚Äù y permite acceso al micr√≥fono para comenzar.</div>

      <div id="transcriptLabel">Rastro de voz (texto aproximado)</div>
      <div id="transcript"></div>
    </div>

    <div class="footnote">
      <div>
        ¬©Ô∏è 2025 Hans Schlechter. Sistema monogram√°tico 2√ó3, c√≥digo y visualidad generativa.
      </div>
      <div>
        Esta obra est√° licenciada bajo
        <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.es" target="_blank" rel="noreferrer">
          Creative Commons BY-NC-ND 4.0
        </a>.
      </div>
      <div>
        Para exhibiciones o usos curatoriales, contactar al autor.
      </div>
    </div>
  </aside>

  <main class="canvas-wrapper">
    <canvas id="stageCanvas"></canvas>
    <div id="wordLabel"></div>
  </main>

  <script>
    // === PATRONES 2x3 DE MONOGRAMAS (a partir de tu tabla) ===
    // Formato: [[1,1,1],[2,1,2]] ‚Üí filas 1 y 2, columnas 1‚Äì3.

    const MONOGRAM_PATTERNS = {
      "a": [[1,0,1],[1,1,0]],
      "b": [[0,1,1],[1,1,0]],
      "c": [[1,1,1],[0,0,1]],
      "d": [[1,0,1],[1,0,1]],
      "e": [[0,1,1],[1,0,1]],
      "f": [[1,1,0],[0,1,1]],
      "g": [[0,1,1],[0,1,1]],
      "h": [[1,0,0],[1,1,1]],
      "i": [[0,1,0],[1,1,1]],
      "j": [[0,0,1],[1,1,1]],
      "k": [[0,1,1],[0,1,0]],
      "l": [[1,1,1],[0,0,0]],
      "m": [[1,1,0],[1,0,0]],
      "n": [[1,0,1],[1,0,0]],
      "√±": [[0,1,0],[0,1,1]],
      "o": [[0,1,1],[1,0,0]],
      "p": [[0,1,1],[0,0,1]],
      "q": [[1,0,1],[0,1,0]],
      "r": [[1,0,0],[1,1,0]],
      "s": [[0,0,1],[0,1,1]],
      "t": [[0,0,1],[1,1,0]],
      "u": [[1,1,0],[0,0,1]],
      "v": [[0,1,0],[1,0,1]],
      "w": [[1,0,0],[0,0,1]],
      "x": [[1,1,0],[0,1,0]],
      "y": [[0,0,1],[1,0,1]],
      "z": [[1,0,0],[0,1,1]],
      "¬°": [[1,0,1],[0,0,1]],
      "!": [[1,0,0],[1,0,1]],
      "¬ø": [[1,0,1],[0,1,1]],
      "?": [[1,1,0],[1,0,1]],
      ".": [[0,0,0],[0,1,0]],
      ",": [[0,1,0],[0,0,1]],
      "0": [[1,1,1],[1,1,1]],
      "1": [[1,1,1],[1,1,0]],
      "2": [[1,1,1],[1,0,1]],
      "3": [[1,1,1],[0,1,1]],
      "4": [[1,1,0],[1,1,1]],
      "5": [[1,0,1],[1,1,1]],
      "6": [[0,1,1],[1,1,1]],
      "7": [[1,1,1],[1,0,0]],
      "8": [[1,1,1],[0,1,0]],
      "9": [[1,1,0],[1,1,0]]
    };

    function getPatternForLetter(letter) {
      if (MONOGRAM_PATTERNS[letter]) {
        return MONOGRAM_PATTERNS[letter];
      }
      return [
        [0,0,0],
        [0,0,0]
      ];
    }

    // === DOM & CANVAS ===
    const startBtn = document.getElementById("startBtn");
    const stopBtn = document.getElementById("stopBtn");
    const statusEl = document.getElementById("status");
    const transcriptEl = document.getElementById("transcript");
    const wordLabelEl = document.getElementById("wordLabel");
    const canvas = document.getElementById("stageCanvas");
    const ctx = canvas.getContext("2d");

    function resizeCanvas() {
      canvas.width = canvas.clientWidth;
      canvas.height = canvas.clientHeight;
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    // === WEB SPEECH API ===
    let recognition = null;
    let isListening = false;

    const SpeechRecognition =
      window.SpeechRecognition || window.webkitSpeechRecognition;

    if (!SpeechRecognition) {
      statusEl.textContent = "Este navegador no soporta Web Speech API. Prueba en Chrome en escritorio.";
      startBtn.disabled = true;
    } else {
      recognition = new SpeechRecognition();
      recognition.lang = "es-CL"; // puedes probar "es-ES" si prefieres
      recognition.continuous = true;
      recognition.interimResults = true;
    }

    // === NORMALIZAR CARACTERES (ESPA√ëOL) ===
    function normalizeChar(ch) {
      if (!ch) return null;
      const lower = ch.toLowerCase();

      const accentMap = {
        "√°": "a",
        "√©": "e",
        "√≠": "i",
        "√≥": "o",
        "√∫": "u",
        "√º": "u"
      };
      if (accentMap[lower]) return accentMap[lower];

      if (lower === "√±") return "√±";

      if (lower >= "a" && lower <= "z") return lower;

      if ("¬°!¬ø?.,0123456789".includes(ch)) return ch;

      return null;
    }

    function wordToLetters(word) {
      const letters = [];
      for (const ch of word) {
        const n = normalizeChar(ch);
        if (n) letters.push(n);
      }
      return letters;
    }

    // === DIBUJAR MATRIZ 2x3 PARA UNA LETRA, CON GAP UNIFICADO ===
    function drawLetterGridUnified(letter, x, y, cellSize, gap) {
      const pattern = getPatternForLetter(letter);
      const rows = 2;
      const cols = 3;

      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          const value = pattern[r][c];

          const cx = x + c * (cellSize + gap);
          const cy = y + r * (cellSize + gap);

          ctx.globalAlpha = 0.12;
          ctx.strokeStyle = "#ffffff";
          ctx.lineWidth = 1;
          ctx.strokeRect(cx, cy, cellSize, cellSize);

          if (value === 1) {
            ctx.globalAlpha = 0.9;
            ctx.fillStyle = "#ffffff";
            ctx.fillRect(cx, cy, cellSize, cellSize);
          }
        }
      }

      ctx.globalAlpha = 1.0;
    }

    // === DIBUJAR PALABRA COMO MOSAICO 2 COLUMNAS, GAP UNIFICADO ===
    function drawWordAsMonograms(word) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      const letters = wordToLetters(word);
      if (letters.length === 0) {
        wordLabelEl.textContent = "";
        return;
      }

      wordLabelEl.textContent = word;

      const base = Math.min(canvas.width, canvas.height);
      const cellSize = base / 20; // ajusta si quieres m√°s grande/peque√±o
      const gap = cellSize * 0.12;

      const cols = 3;
      const rows = 2;

      const gridWidth = cols * cellSize + (cols - 1) * gap;
      const gridHeight = rows * cellSize + (rows - 1) * gap;

      const monogramsPerRow = 2;
      const numRows = Math.ceil(letters.length / monogramsPerRow);

      const rowGap = gap;
      const colGap = gap;

      const totalWidth =
        monogramsPerRow * gridWidth + (monogramsPerRow - 1) * colGap;
      const totalHeight =
        numRows * gridHeight + (numRows - 1) * rowGap;

      const startX = (canvas.width - totalWidth) / 2;
      const startY = (canvas.height - totalHeight) / 2;

      let rowIndex = 0;
      for (let i = 0; i < letters.length; i += 2) {
        const letterLeft = letters[i];
        const letterRight = letters[i + 1] || null;

        const y = startY + rowIndex * (gridHeight + rowGap);

        const xLeft = startX;
        drawLetterGridUnified(letterLeft, xLeft, y, cellSize, gap);

        if (letterRight) {
          const xRight = startX + gridWidth + colGap;
          drawLetterGridUnified(letterRight, xRight, y, cellSize, gap);
        }

        rowIndex++;
      }
    }

    // === MANEJO DE RESULTADOS DE VOZ ===
    function handleResult(event) {
      let fullTranscriptChunk = "";

      for (let i = event.resultIndex; i < event.results.length; i++) {
        const res = event.results[i];
        fullTranscriptChunk += res[0].transcript;
      }

      transcriptEl.textContent =
        (transcriptEl.textContent + " " + fullTranscriptChunk).trim();

      const words = transcriptEl.textContent
        .split(/\s+/)
        .map(w => w.trim())
        .filter(w => w.length > 0);

      if (words.length === 0) return;

      const lastWord = words[words.length - 1];
      drawWordAsMonograms(lastWord);
    }

    if (recognition) {
      recognition.onstart = () => {
        isListening = true;
        statusEl.textContent = "Escuchando... Juega con tu voz cerca del micr√≥fono.";
        startBtn.disabled = true;
        stopBtn.disabled = false;
      };

      recognition.onend = () => {
        isListening = false;
        statusEl.textContent = "Detenido. Puedes pulsar ‚ÄúStart‚Äù para reanudar.";
        startBtn.disabled = false;
        stopBtn.disabled = true;
      };

      recognition.onerror = (event) => {
        console.error("Speech recognition error:", event.error);
        statusEl.textContent = "Error de reconocimiento: " + event.error;
      };

      recognition.onresult = handleResult;
    }

    startBtn.addEventListener("click", () => {
      if (!recognition || isListening) return;
      transcriptEl.textContent = "";
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      wordLabelEl.textContent = "";
      try {
        recognition.start();
      } catch (e) {
        console.error(e);
      }
    });

    stopBtn.addEventListener("click", () => {
      if (!recognition || !isListening) return;
      recognition.stop();
    });
  </script>
</body>
</html>
